<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NaruTalk í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .test-button {
            background: #4f46e5;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 0.9rem;
        }
        .test-button:hover {
            background: #4338ca;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        .success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        .info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        .test-input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        .response-display {
            background: #f8fafc;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            border: 1px solid #e2e8f0;
        }
        .router-info {
            font-size: 0.8rem;
            color: #64748b;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>NaruTalk í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸</h1>
        
        <!-- API ì—°ê²° í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <div class="test-title">1. API ì—°ê²° í…ŒìŠ¤íŠ¸</div>
            <button class="test-button" onclick="testHealthCheck()">í—¬ìŠ¤ ì²´í¬</button>
            <button class="test-button" onclick="testRouterTypes()">ë¼ìš°í„° íƒ€ì… ì¡°íšŒ</button>
            <div id="apiTestResult" class="test-result"></div>
        </div>

        <!-- ì±„íŒ… ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <div class="test-title">2. ì±„íŒ… ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</div>
            <input type="text" id="testMessage" class="test-input" placeholder="í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="ì•ˆë…•í•˜ì„¸ìš”">
            <button class="test-button" onclick="testChat()">ë©”ì‹œì§€ ì „ì†¡</button>
            <div id="chatTestResult" class="test-result"></div>
        </div>

        <!-- ë¼ìš°í„° í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <div class="test-title">3. ë¼ìš°í„° ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</div>
            <button class="test-button" onclick="testQARouter()">ì§ˆë¬¸ë‹µë³€ ë¼ìš°í„°</button>
            <button class="test-button" onclick="testDocumentRouter()">ë¬¸ì„œê²€ìƒ‰ ë¼ìš°í„°</button>
            <button class="test-button" onclick="testEmployeeRouter()">ì§ì›ì •ë³´ ë¼ìš°í„°</button>
            <button class="test-button" onclick="testGeneralRouter()">ì¼ë°˜ëŒ€í™” ë¼ìš°í„°</button>
            <div id="routerTestResult" class="test-result"></div>
        </div>

        <!-- ì„ë² ë”© ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <div class="test-title">4. ì„ë² ë”© ê²€ìƒ‰ í…ŒìŠ¤íŠ¸</div>
            <input type="text" id="searchQuery" class="test-input" placeholder="ê²€ìƒ‰í•  í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="íšŒì‚¬ ì •ì±…">
            <button class="test-button" onclick="testEmbeddingSearch()">ë¬¸ì„œ ê²€ìƒ‰</button>
            <div id="embeddingTestResult" class="test-result"></div>
        </div>

        <!-- ì±—ë´‡ UI í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <div class="test-title">5. ì±—ë´‡ UI í…ŒìŠ¤íŠ¸</div>
            <button class="test-button" onclick="testChatbotToggle()">ì±—ë´‡ í† ê¸€</button>
            <button class="test-button" onclick="testChatbotKeyboard()">í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (Ctrl+/)</button>
            <div id="uiTestResult" class="test-result"></div>
        </div>

        <!-- ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <div class="test-title">6. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</div>
            <button class="test-button" onclick="testPerformance()">ì‘ë‹µ ì‹œê°„ ì¸¡ì •</button>
            <button class="test-button" onclick="testMultipleRequests()">ë‹¤ì¤‘ ìš”ì²­ í…ŒìŠ¤íŠ¸</button>
            <div id="performanceTestResult" class="test-result"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = '/api/v1';
        
        // ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
        function displayResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `test-result ${type}`;
            element.innerHTML = message;
        }

        // 1. API ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testHealthCheck() {
            try {
                const response = await fetch('/health');
                const data = await response.json();
                
                if (data.status === 'ok') {
                    displayResult('apiTestResult', 'âœ… í—¬ìŠ¤ ì²´í¬ ì„±ê³µ: ' + data.message, 'success');
                } else {
                    displayResult('apiTestResult', 'âŒ í—¬ìŠ¤ ì²´í¬ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                displayResult('apiTestResult', 'âŒ í—¬ìŠ¤ ì²´í¬ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        async function testRouterTypes() {
            try {
                const response = await fetch(`${API_BASE_URL}/router/types`);
                const data = await response.json();
                
                if (data.router_types && data.router_types.length === 4) {
                    const types = data.router_types.map(type => type.name).join(', ');
                    displayResult('apiTestResult', `âœ… ë¼ìš°í„° íƒ€ì… ì¡°íšŒ ì„±ê³µ: ${types}`, 'success');
                } else {
                    displayResult('apiTestResult', 'âŒ ë¼ìš°í„° íƒ€ì… ì¡°íšŒ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                displayResult('apiTestResult', 'âŒ ë¼ìš°í„° íƒ€ì… ì¡°íšŒ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // 2. ì±„íŒ… ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
        async function testChat() {
            const message = document.getElementById('testMessage').value;
            if (!message) {
                displayResult('chatTestResult', 'âŒ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        user_id: 'test_user',
                        session_id: 'test_session'
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    const result = `
                        <div class="response-display">
                            <strong>ì‘ë‹µ:</strong> ${data.response}<br>
                            <div class="router-info">ë¼ìš°í„°: ${data.router_type} (ì‹ ë¢°ë„: ${Math.round(data.confidence * 100)}%)</div>
                        </div>
                    `;
                    displayResult('chatTestResult', 'âœ… ì±„íŒ… í…ŒìŠ¤íŠ¸ ì„±ê³µ' + result, 'success');
                } else {
                    displayResult('chatTestResult', 'âŒ ì±„íŒ… í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + data.detail, 'error');
                }
            } catch (error) {
                displayResult('chatTestResult', 'âŒ ì±„íŒ… í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // 3. ë¼ìš°í„° ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
        async function testQARouter() {
            await testSpecificRouter('íšŒì‚¬ ì •ì±…ì— ëŒ€í•´ ì•Œë ¤ì£¼ì„¸ìš”', 'qa');
        }

        async function testDocumentRouter() {
            await testSpecificRouter('ë¬¸ì„œë¥¼ ê²€ìƒ‰í•´ì£¼ì„¸ìš”', 'document_search');
        }

        async function testEmployeeRouter() {
            await testSpecificRouter('ê¹€í˜„ì„± ì§ì› ì •ë³´ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”', 'employee_info');
        }

        async function testGeneralRouter() {
            await testSpecificRouter('ì•ˆë…•í•˜ì„¸ìš”', 'general_chat');
        }

        async function testSpecificRouter(message, expectedType) {
            try {
                const response = await fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        user_id: 'test_user',
                        session_id: 'test_session'
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.router_type === expectedType) {
                    displayResult('routerTestResult', `âœ… ${expectedType} ë¼ìš°í„° í…ŒìŠ¤íŠ¸ ì„±ê³µ: "${message}" â†’ ${data.router_type}`, 'success');
                } else {
                    displayResult('routerTestResult', `âŒ ${expectedType} ë¼ìš°í„° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ì˜ˆìƒ ${expectedType}, ì‹¤ì œ ${data.router_type}`, 'error');
                }
            } catch (error) {
                displayResult('routerTestResult', `âŒ ${expectedType} ë¼ìš°í„° í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ` + error.message, 'error');
            }
        }

        // 4. ì„ë² ë”© ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
        async function testEmbeddingSearch() {
            const query = document.getElementById('searchQuery').value;
            if (!query) {
                displayResult('embeddingTestResult', 'âŒ ê²€ìƒ‰ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/embedding/search?query=${encodeURIComponent(query)}&limit=3`, {
                    method: 'POST'
                });

                const data = await response.json();
                
                if (response.ok) {
                    const resultCount = data.results.length;
                    displayResult('embeddingTestResult', `âœ… ì„ë² ë”© ê²€ìƒ‰ ì„±ê³µ: ${resultCount}ê°œ ê²°ê³¼ ë°œê²¬`, 'success');
                } else {
                    displayResult('embeddingTestResult', 'âŒ ì„ë² ë”© ê²€ìƒ‰ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                displayResult('embeddingTestResult', 'âŒ ì„ë² ë”© ê²€ìƒ‰ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // 5. ì±—ë´‡ UI í…ŒìŠ¤íŠ¸
        function testChatbotToggle() {
            // ì‹¤ì œ ì±—ë´‡ UIê°€ ë¡œë“œë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            if (parent.document.getElementById('chatbotToggle')) {
                parent.document.getElementById('chatbotToggle').click();
                displayResult('uiTestResult', 'âœ… ì±—ë´‡ í† ê¸€ í…ŒìŠ¤íŠ¸ ì„±ê³µ', 'success');
            } else {
                displayResult('uiTestResult', 'âŒ ì±—ë´‡ UIë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
            }
        }

        function testChatbotKeyboard() {
            displayResult('uiTestResult', 'ğŸ’¡ ë©”ì¸ í˜ì´ì§€ì—ì„œ Ctrl+/ í‚¤ë¥¼ ëˆŒëŸ¬ ì±—ë´‡ì„ í† ê¸€í•´ë³´ì„¸ìš”', 'info');
        }

        // 6. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
        async function testPerformance() {
            const startTime = performance.now();
            
            try {
                const response = await fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€',
                        user_id: 'test_user',
                        session_id: 'performance_test'
                    })
                });

                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);

                if (response.ok) {
                    displayResult('performanceTestResult', `âœ… ì‘ë‹µ ì‹œê°„: ${responseTime}ms`, 'success');
                } else {
                    displayResult('performanceTestResult', `âŒ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ (ì‘ë‹µ ì‹œê°„: ${responseTime}ms)`, 'error');
                }
            } catch (error) {
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);
                displayResult('performanceTestResult', `âŒ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message} (${responseTime}ms)`, 'error');
            }
        }

        async function testMultipleRequests() {
            const startTime = performance.now();
            const promises = [];

            for (let i = 0; i < 5; i++) {
                promises.push(fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: `ë‹¤ì¤‘ ìš”ì²­ í…ŒìŠ¤íŠ¸ ${i + 1}`,
                        user_id: 'test_user',
                        session_id: `multi_test_${i}`
                    })
                }));
            }

            try {
                const responses = await Promise.all(promises);
                const endTime = performance.now();
                const totalTime = Math.round(endTime - startTime);

                const successCount = responses.filter(r => r.ok).length;
                displayResult('performanceTestResult', `âœ… ë‹¤ì¤‘ ìš”ì²­ í…ŒìŠ¤íŠ¸: ${successCount}/5 ì„±ê³µ (ì´ ì‹œê°„: ${totalTime}ms)`, 'success');
            } catch (error) {
                displayResult('performanceTestResult', 'âŒ ë‹¤ì¤‘ ìš”ì²­ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° í…ŒìŠ¤íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            displayResult('apiTestResult', 'í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ. ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”.', 'info');
        });
    </script>
</body>
</html> 