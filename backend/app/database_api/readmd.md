# Database API 구조 및 데이터베이스 설계 문서

## 1. 데이터베이스 툴 및 역할

- **PostgreSQL**
  - 문서 메타데이터, 키워드, 키워드-문서 매핑 등 관계형 데이터 저장
- **OpenSearch**
  - 문서 청크(embedding, content 등) 인덱싱 및 유사도 검색
- **MinIO (S3 호환)**
  - 문서 원본 파일 저장 (오브젝트 스토리지)


## 2. 각 툴의 관계 및 데이터 흐름

1. **문서 업로드**
   - 사용자가 문서를 업로드하면, 원본 파일은 MinIO(S3)에 저장
   - 문서의 메타데이터(제목, 설명, S3 URL 등)는 PostgreSQL에 저장
2. **문서 청크/임베딩**
   - 문서를 청크로 분할하고, 각 청크의 임베딩/내용/문서ID 등은 OpenSearch에 저장
3. **검색/매핑/요약**
   - 쿼리 임베딩 → OpenSearch에서 유사 청크 검색 → document_id로 PostgreSQL에서 원본 문서 정보 조회
   - 키워드 검색은 PostgreSQL에서 키워드-문서 매핑 테이블을 활용

---

## 3. 사용자/관리자 접근 구조

- **일반 사용자**
  - FastAPI 기반 app(서비스)을 통해서만 기능을 호출할 수 있습니다.
  - 사용자가 직접 데이터베이스(PostgreSQL, OpenSearch)에 접근하지 않고,
    app이 내부적으로 데이터베이스에 접근하여 CRUD(생성, 조회, 수정, 삭제) 작업을 처리합니다.
  - 즉, 사용자는 API를 통해 문서 업로드, 검색, 요약 등 기능만 이용할 수 있습니다.

- **관리자**
  - OpenSearch Dashboards(예: http://localhost:5601), pgAdmin(예: http://localhost:5050) 등
    데이터베이스 대시보드에 직접 접근할 수 있습니다.
  - 관리자는 데이터베이스의 상태 모니터링, 직접 쿼리, 데이터 관리 등 고급 기능을 사용할 수 있습니다.

---

> 이 문서는 데이터베이스 툴의 역할과 데이터 흐름, 사용자/관리자 접근 구조를 빠르게 파악하고, 다른 환경에서 개발을 이어갈 때 참고용으로 활용할 수 있습니다. 